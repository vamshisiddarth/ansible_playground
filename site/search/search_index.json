{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"This will be your guide to start learning and understanding the ansible playbooks and roles. The roles you find here can be used to build a production grade application infrastructure. We will be using the AWS Dynamic inventory to run the roles on the AWS instances. You can find some simple terraform code to build your basic infrastructure to execute these roles on your own aws account. Docker and Docker Compose \u00b6 We will be deploying most of our services as Docker containers on the aws instances using these Ansible roles. Deploying as container is a very straight forward and simplest approach as you don't really have to deal with the dependencies like libraries, os versions and other dependencies. Terraform \u00b6 You can find a sample terraform code under terraform directory which will help you quickly build your infrastructure on your personal aws account. You may then deploy these services using the ansible roles on the newly created instances. If you choose to have a dedicated code repository for terraform you may refer to this repository . Directories \u00b6 group_vars \u00b6 Declare all the global level variables here. terraform \u00b6 These files help us to create the simple instance on which we can run our Ansible Playbooks. ssh \u00b6 Configuration to ssh proxy to the servers in the vpc using the Bastion instance. _ssh \u00b6 Consists of the Key files which we used to authenticate to the aws server. inventory \u00b6 Dynamic Inventory configuration to identify the aws instances using special naming conventions. roles \u00b6 All the ansible roles will be located here in this directory.","title":"Introduction"},{"location":"#docker-and-docker-compose","text":"We will be deploying most of our services as Docker containers on the aws instances using these Ansible roles. Deploying as container is a very straight forward and simplest approach as you don't really have to deal with the dependencies like libraries, os versions and other dependencies.","title":"Docker and Docker Compose"},{"location":"#terraform","text":"You can find a sample terraform code under terraform directory which will help you quickly build your infrastructure on your personal aws account. You may then deploy these services using the ansible roles on the newly created instances. If you choose to have a dedicated code repository for terraform you may refer to this repository .","title":"Terraform"},{"location":"#directories","text":"","title":"Directories"},{"location":"#group_vars","text":"Declare all the global level variables here.","title":"group_vars"},{"location":"#terraform_1","text":"These files help us to create the simple instance on which we can run our Ansible Playbooks.","title":"terraform"},{"location":"#ssh","text":"Configuration to ssh proxy to the servers in the vpc using the Bastion instance.","title":"ssh"},{"location":"#_ssh","text":"Consists of the Key files which we used to authenticate to the aws server.","title":"_ssh"},{"location":"#inventory","text":"Dynamic Inventory configuration to identify the aws instances using special naming conventions.","title":"inventory"},{"location":"#roles","text":"All the ansible roles will be located here in this directory.","title":"roles"},{"location":"Quick-Start/","text":"Steps to follow \u00b6 Prepare your local machine \u00b6 Clone the repository on your machine. Use any IDE of your choice. I'm using Jet Brains Intellij . Navigate to the repository on the terminal and execute the below. ./pip-install.sh Install AWS Plugin \u00b6 Install the amazon aws plugin using below. $ ansible-galaxy collection install amazon.aws Configure Ansible Vault \u00b6 Create vault-password.txt file with your vault password. Check vault-password.example.txt file for reference. The vault.sh script can be used to encrypt and decrypt your group_vars file. This will be explained later. Configure AWS Credentials \u00b6 Create credentials.txt file with your aws access key and secret key. You may also choose the region of your choice. Check credentials.example.txt file for reference. Generate Inventory File \u00b6 Generate the Inventory File for your environment using below. $ ./gen-inventory-yaml.sh Welcome!! You will now be able to generate the credential file for your new environment/account. Please provide the below requested details environment: stage aws_access_key_id: AKIARMAHSDVFVEFCDCD aws_secret_access_key: JSADSDdsdmcdc3453422/34e324e3dsacaDFG iam_role_arn: arn:aws:iam::0912345553223:role/Administrator Inventory Credential File created successfully!! Generate the Key File \u00b6 Generate the key files which will be used for authentication into the new servers we create. $ ./gen-key.sh Welcome!! You will now be able to generate the key files for your new environment/account. Please provide the below requested details environment: dev Generating public/private rsa key pair. Your identification has been saved in _ssh/dev-env-key.pem. Your public key has been saved in _ssh/dev-env-key.pem.pub. The key fingerprint is: SHA256:eDfWwhh/wLhviuyj6SZ0OaVLu3AdrWioiQkPJOO/TlA vamshisiddarthgaddam@Vamshis-MBP-2 The key ' s randomart image is: +--- [ RSA 2048 ] ----+ | | | o | | E o o | | . .o * o | | oo +o S B o | | +.o.*o + + + | | ooo+++o o | | o*+++o.. o | | = oB*++.. | +---- [ SHA256 ] -----+ Key File created successfully!! Create A Free Domain \u00b6 Create a Free Domain for yourself. I have created vamshi.cf using Freenom . We will then create a hosted zone in our AWS account and we need to update the nameservers in freenom with AWS nameservers. Update Terraform files \u00b6 Navigate to the terraform directory and update the vars.tf and key-file.tf with suitable values. # key-file.tf resource \"aws_key_pair\" \"dev-key\" { key_name = var . key_name public_key = file ( \"./../_ssh/dev-env-key.pem.pub\" ) # This should be your environment key file name } # vars.tf variable \"domain_name\" { default = \"vamshi.cf\" # Update with your domain name } Create AWS Resources using Terraform \u00b6 Once these files are updated, execute the below to create the new resources in aws. $ ./run.sh apply -auto-approve Verify DNS Resolution \u00b6 Once this is done, we need to update the nameservers for the domain. It might take a little time for the domain name to resolve. Once it is successful, you might find similar output. $ nslookup bastion.vamshi.cf Server: 192 .168.0.1 Address: 192 .168.0.1#53 Non-authoritative answer: Name: bastion.vamshi.cf Address: 54 .220.236.92 Confirm SSH Connection \u00b6 You can now ssh into the newly created instance using the below command. $ ssh -F \"./ssh/web.ssh.config\" ubuntu@172.16.10.120 * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue Jan 26 12 :28:15 UTC 2021 System load: 0 .08 Processes: 96 Usage of /: 14 .0% of 7 .69GB Users logged in: 0 Memory usage: 18 % IP address for ens5: 172 .16.10.120 Swap usage: 0 % 0 packages can be updated. 0 updates are security updates. To run a command as administrator ( user \"root\" ) , use \"sudo <command>\" . See \"man sudo_root\" for details. ubuntu@ip-172-16-10-120:~$ With this, you have now completed the Dynamic Inventory configuration.","title":"Quick Start Guide"},{"location":"Quick-Start/#steps-to-follow","text":"","title":"Steps to follow"},{"location":"Quick-Start/#prepare-your-local-machine","text":"Clone the repository on your machine. Use any IDE of your choice. I'm using Jet Brains Intellij . Navigate to the repository on the terminal and execute the below. ./pip-install.sh","title":"Prepare your local machine"},{"location":"Quick-Start/#install-aws-plugin","text":"Install the amazon aws plugin using below. $ ansible-galaxy collection install amazon.aws","title":"Install AWS Plugin"},{"location":"Quick-Start/#configure-ansible-vault","text":"Create vault-password.txt file with your vault password. Check vault-password.example.txt file for reference. The vault.sh script can be used to encrypt and decrypt your group_vars file. This will be explained later.","title":"Configure Ansible Vault"},{"location":"Quick-Start/#configure-aws-credentials","text":"Create credentials.txt file with your aws access key and secret key. You may also choose the region of your choice. Check credentials.example.txt file for reference.","title":"Configure AWS Credentials"},{"location":"Quick-Start/#generate-inventory-file","text":"Generate the Inventory File for your environment using below. $ ./gen-inventory-yaml.sh Welcome!! You will now be able to generate the credential file for your new environment/account. Please provide the below requested details environment: stage aws_access_key_id: AKIARMAHSDVFVEFCDCD aws_secret_access_key: JSADSDdsdmcdc3453422/34e324e3dsacaDFG iam_role_arn: arn:aws:iam::0912345553223:role/Administrator Inventory Credential File created successfully!!","title":"Generate Inventory File"},{"location":"Quick-Start/#generate-the-key-file","text":"Generate the key files which will be used for authentication into the new servers we create. $ ./gen-key.sh Welcome!! You will now be able to generate the key files for your new environment/account. Please provide the below requested details environment: dev Generating public/private rsa key pair. Your identification has been saved in _ssh/dev-env-key.pem. Your public key has been saved in _ssh/dev-env-key.pem.pub. The key fingerprint is: SHA256:eDfWwhh/wLhviuyj6SZ0OaVLu3AdrWioiQkPJOO/TlA vamshisiddarthgaddam@Vamshis-MBP-2 The key ' s randomart image is: +--- [ RSA 2048 ] ----+ | | | o | | E o o | | . .o * o | | oo +o S B o | | +.o.*o + + + | | ooo+++o o | | o*+++o.. o | | = oB*++.. | +---- [ SHA256 ] -----+ Key File created successfully!!","title":"Generate the Key File"},{"location":"Quick-Start/#create-a-free-domain","text":"Create a Free Domain for yourself. I have created vamshi.cf using Freenom . We will then create a hosted zone in our AWS account and we need to update the nameservers in freenom with AWS nameservers.","title":"Create A Free Domain"},{"location":"Quick-Start/#update-terraform-files","text":"Navigate to the terraform directory and update the vars.tf and key-file.tf with suitable values. # key-file.tf resource \"aws_key_pair\" \"dev-key\" { key_name = var . key_name public_key = file ( \"./../_ssh/dev-env-key.pem.pub\" ) # This should be your environment key file name } # vars.tf variable \"domain_name\" { default = \"vamshi.cf\" # Update with your domain name }","title":"Update Terraform files"},{"location":"Quick-Start/#create-aws-resources-using-terraform","text":"Once these files are updated, execute the below to create the new resources in aws. $ ./run.sh apply -auto-approve","title":"Create AWS Resources using Terraform"},{"location":"Quick-Start/#verify-dns-resolution","text":"Once this is done, we need to update the nameservers for the domain. It might take a little time for the domain name to resolve. Once it is successful, you might find similar output. $ nslookup bastion.vamshi.cf Server: 192 .168.0.1 Address: 192 .168.0.1#53 Non-authoritative answer: Name: bastion.vamshi.cf Address: 54 .220.236.92","title":"Verify DNS Resolution"},{"location":"Quick-Start/#confirm-ssh-connection","text":"You can now ssh into the newly created instance using the below command. $ ssh -F \"./ssh/web.ssh.config\" ubuntu@172.16.10.120 * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue Jan 26 12 :28:15 UTC 2021 System load: 0 .08 Processes: 96 Usage of /: 14 .0% of 7 .69GB Users logged in: 0 Memory usage: 18 % IP address for ens5: 172 .16.10.120 Swap usage: 0 % 0 packages can be updated. 0 updates are security updates. To run a command as administrator ( user \"root\" ) , use \"sudo <command>\" . See \"man sudo_root\" for details. ubuntu@ip-172-16-10-120:~$ With this, you have now completed the Dynamic Inventory configuration.","title":"Confirm SSH Connection"},{"location":"base-role/","text":"Now, we have instance ready to use, let's prepare the instance with all required dependencies which include installation and configuration of zsh, monit and etc. Bastion Playbook \u00b6 Before executing the playbook, let's take a moment and understand what exactly is configured in the playbook. - name : dev bastion # Hostname configured as per Dynamic Inventory # You can understand more about this by executing ansible inventory command(ansible-inventory --list) hosts : tag_project_dev_bastion # User to run the playbook on the remote instance remote_user : ubuntu become : true # All the roles that we wish to execute on the remote instance # The roles declared here will be executed. Ansible will search for the roles under roles directory. # This is configured in ansible.cfg file roles : - { role : base , tags : [ 'base' ] } - { role : monit , tags : [ 'monit' ] } Execution \u00b6 To execute the playbook, run the below command. Wait until the execution is completed and check for any errors. $ ansible-playbook dev-bastion.yml Output You should find the output similar to below. PLAY [dev bastion] ***************************************************************************************************************************************************************************************************** TASK [common : dpkg --configure -a] ************************************************************************************************************************************************************************************ Wednesday 27 January 2021 17:57:42 +0400 (0:00:00.070) 0:00:00.070 ***** changed: [172.16.10.120] TASK [common : install system pakcages and utils] ********************************************************************************************************************************************************************** Wednesday 27 January 2021 17:57:44 +0400 (0:00:02.013) 0:00:02.083 ***** ok: [172.16.10.120] TASK [common : correct python version selected] ************************************************************************************************************************************************************************ Wednesday 27 January 2021 17:57:49 +0400 (0:00:04.600) 0:00:06.683 ***** ok: [172.16.10.120] TASK [common : install pip packages ( aws .. )] ************************************************************************************************************************************************************************ Wednesday 27 January 2021 17:57:51 +0400 (0:00:02.412) 0:00:09.095 ***** ok: [172.16.10.120] TASK [common : enable /etc/default/sysstat] **************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:57:57 +0400 (0:00:05.913) 0:00:15.008 ***** ok: [172.16.10.120] TASK [common : set sysctl values] ************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:57:59 +0400 (0:00:01.478) 0:00:16.487 ***** ok: [172.16.10.120] => (item={'name': 'net.core.somaxconn', 'value': 65535}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.tcp_max_syn_backlog', 'value': 65535}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.tcp_fin_timeout', 'value': 20}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.tcp_max_tw_buckets', 'value': 1440000}) ok: [172.16.10.120] => (item={'name': 'vm.overcommit_memory', 'value': 1}) ok: [172.16.10.120] => (item={'name': 'vm.vfs_cache_pressure', 'value': 60}) ok: [172.16.10.120] => (item={'name': 'vm.max_map_count', 'value': 262144}) ok: [172.16.10.120] => (item={'name': 'fs.file-max', 'value': 1000000}) ok: [172.16.10.120] => (item={'name': 'kernel.pid_max', 'value': 65536}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.ip_local_port_range', 'value': '10000 65535'}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.udp_rmem_min', 'value': 8192}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.udp_wmem_min', 'value': 8192}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.tcp_syncookies', 'value': 1}) ok: [172.16.10.120] => (item={'name': 'fs.nr_open', 'value': 10485760}) TASK [common : configure max open file number limits] ****************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:10 +0400 (0:00:11.748) 0:00:28.235 ***** ok: [172.16.10.120] => (item={'domain': '*', 'type': 'soft', 'name': 'memlock', 'value': 'unlimited'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'hard', 'name': 'memlock', 'value': 'unlimited'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'soft', 'name': 'nofile', 'value': '1000000'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'hard', 'name': 'nofile', 'value': '1000000'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'soft', 'name': 'nproc', 'value': '1000000'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'hard', 'name': 'nproc', 'value': '1000000'}) TASK [common : disable kernel.mm.transparent_hugepage debian] ********************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:15 +0400 (0:00:04.965) 0:00:33.200 ***** ok: [172.16.10.120] TASK [common : disable kernel.mm.transparent_hugepage redhat] ********************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:19 +0400 (0:00:03.344) 0:00:36.544 ***** skipping: [172.16.10.120] TASK [common : Disable Transparent Huge Pages until reboot] ************************************************************************************************************************************************************ Wednesday 27 January 2021 17:58:19 +0400 (0:00:00.040) 0:00:36.585 ***** changed: [172.16.10.120] TASK [common : install git and zsh debian] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:20 +0400 (0:00:00.812) 0:00:37.398 ***** ok: [172.16.10.120] TASK [common : install git and zsh redhat] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:21 +0400 (0:00:01.704) 0:00:39.102 ***** skipping: [172.16.10.120] TASK [common : clone oh-my-zsh repo] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:21 +0400 (0:00:00.039) 0:00:39.142 ***** ok: [172.16.10.120] => (item={'name': 'https://github.com/robbyrussell/oh-my-zsh', 'dir': 'oh-my-zsh'}) ok: [172.16.10.120] => (item={'name': 'https://github.com/zsh-users/zsh-syntax-highlighting', 'dir': 'zsh-syntax-highlighting'}) ok: [172.16.10.120] => (item={'name': 'git://github.com/zsh-users/zsh-autosuggestions', 'dir': 'zsh-autosuggestions'}) TASK [common : create conf folder in home directory] ******************************************************************************************************************************************************************* Wednesday 27 January 2021 17:58:29 +0400 (0:00:07.820) 0:00:46.963 ***** ok: [172.16.10.120] => (item=/usr/local/share/oh-my-zsh/conf/) ok: [172.16.10.120] => (item=/usr/local/share/oh-my-zsh/cache/) TASK [common : deploy .zshrc] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:31 +0400 (0:00:01.830) 0:00:48.794 ***** ok: [172.16.10.120] TASK [common : deploy .extra] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:34 +0400 (0:00:03.172) 0:00:51.967 ***** ok: [172.16.10.120] TASK [common : deploy .aliases] **************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:37 +0400 (0:00:03.212) 0:00:55.180 ***** ok: [172.16.10.120] TASK [common : deploy .bash_profile] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:41 +0400 (0:00:03.178) 0:00:58.358 ***** ok: [172.16.10.120] TASK [common : remove standard zshrc] ********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:44 +0400 (0:00:03.064) 0:01:01.422 ***** changed: [172.16.10.120] TASK [common : symlink zshrc] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:44 +0400 (0:00:00.831) 0:01:02.254 ***** changed: [172.16.10.120] TASK [common : Update pamd rule's control in /etc/pam.d/chsh] ********************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:45 +0400 (0:00:00.824) 0:01:03.079 ***** ok: [172.16.10.120] TASK [common : set zsh as default shell] ******************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:58:46 +0400 (0:00:01.016) 0:01:04.095 ***** changed: [172.16.10.120] TASK [common : install git and zsh debian] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:47 +0400 (0:00:00.822) 0:01:04.917 ***** ok: [172.16.10.120] TASK [common : install git and zsh redhat] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:49 +0400 (0:00:01.667) 0:01:06.584 ***** skipping: [172.16.10.120] TASK [common : clone oh-my-zsh repo] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:49 +0400 (0:00:00.035) 0:01:06.620 ***** ok: [172.16.10.120] => (item={'name': 'https://github.com/robbyrussell/oh-my-zsh', 'dir': 'oh-my-zsh'}) ok: [172.16.10.120] => (item={'name': 'https://github.com/zsh-users/zsh-syntax-highlighting', 'dir': 'zsh-syntax-highlighting'}) ok: [172.16.10.120] => (item={'name': 'git://github.com/zsh-users/zsh-autosuggestions', 'dir': 'zsh-autosuggestions'}) TASK [common : create conf folder in home directory] ******************************************************************************************************************************************************************* Wednesday 27 January 2021 17:58:55 +0400 (0:00:06.607) 0:01:13.228 ***** ok: [172.16.10.120] => (item=/usr/local/share/oh-my-zsh/conf/) ok: [172.16.10.120] => (item=/usr/local/share/oh-my-zsh/cache/) TASK [common : deploy .zshrc] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:57 +0400 (0:00:01.600) 0:01:14.828 ***** ok: [172.16.10.120] TASK [common : deploy .extra] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:00 +0400 (0:00:03.162) 0:01:17.990 ***** ok: [172.16.10.120] TASK [common : deploy .aliases] **************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:03 +0400 (0:00:03.191) 0:01:21.181 ***** ok: [172.16.10.120] TASK [common : deploy .bash_profile] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:06 +0400 (0:00:03.006) 0:01:24.187 ***** ok: [172.16.10.120] TASK [common : remove standard zshrc] ********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:10 +0400 (0:00:03.192) 0:01:27.380 ***** changed: [172.16.10.120] TASK [common : symlink zshrc] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:10 +0400 (0:00:00.824) 0:01:28.205 ***** changed: [172.16.10.120] TASK [common : Update pamd rule's control in /etc/pam.d/chsh] ********************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:11 +0400 (0:00:00.969) 0:01:29.175 ***** ok: [172.16.10.120] TASK [common : set zsh as default shell] ******************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:59:12 +0400 (0:00:00.806) 0:01:29.981 ***** changed: [172.16.10.120] TASK [common : transfer ssh config /etc/ssh/ssh_config] **************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:13 +0400 (0:00:00.811) 0:01:30.792 ***** ok: [172.16.10.120] TASK [ensure monit installed] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:16 +0400 (0:00:02.997) 0:01:33.790 ***** ok: [172.16.10.120] TASK [monit : Download EPEL Repo] ************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:18 +0400 (0:00:01.931) 0:01:35.721 ***** skipping: [172.16.10.120] TASK [ensure monit installed] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:18 +0400 (0:00:00.040) 0:01:35.762 ***** skipping: [172.16.10.120] TASK [get monit version] *********************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:18 +0400 (0:00:00.041) 0:01:35.803 ***** changed: [172.16.10.120] TASK [set monit version] *********************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:19 +0400 (0:00:00.816) 0:01:36.620 ***** ok: [172.16.10.120] TASK [stop monit] ****************************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:19 +0400 (0:00:00.046) 0:01:36.667 ***** skipping: [172.16.10.120] TASK [monit dirs] ****************************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:19 +0400 (0:00:00.043) 0:01:36.711 ***** ok: [172.16.10.120] => (item=/var/monit/) ok: [172.16.10.120] => (item=//var/lib/monit/) ok: [172.16.10.120] => (item=/etc/monit/) TASK [/var/lib/monit/ dir] ********************************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:59:21 +0400 (0:00:02.555) 0:01:39.267 ***** skipping: [172.16.10.120] => (item=/etc/monit/conf.d/) skipping: [172.16.10.120] => (item=/var/lib/monit/) TASK [download and unzip monit] **************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:21 +0400 (0:00:00.048) 0:01:39.316 ***** skipping: [172.16.10.120] TASK [download and unzip monit] **************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:22 +0400 (0:00:00.034) 0:01:39.350 ***** skipping: [172.16.10.120] TASK [monit bin] ******************************************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:59:22 +0400 (0:00:00.041) 0:01:39.392 ***** skipping: [172.16.10.120] TASK [transfer monit config /etc/monit/monitrc] ************************************************************************************************************************************************************************ Wednesday 27 January 2021 17:59:22 +0400 (0:00:00.044) 0:01:39.436 ***** ok: [172.16.10.120] TASK [transfer monit config /etc/monitrc] ****************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:25 +0400 (0:00:03.049) 0:01:42.486 ***** ok: [172.16.10.120] TASK [transfer monit id /var/lib/monit/id] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:28 +0400 (0:00:03.181) 0:01:45.667 ***** ok: [172.16.10.120] TASK [transfer monit-config configuration] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:31 +0400 (0:00:03.020) 0:01:48.688 ***** ok: [172.16.10.120] => (item=/Users/vamshisiddarthgaddam/workspace/ansible_playground/roles/monit/tasks/../templates/monit/conf.d/sshd.conf) ok: [172.16.10.120] => (item=/Users/vamshisiddarthgaddam/workspace/ansible_playground/roles/monit/tasks/../templates/monit/conf.d/system.conf) ok: [172.16.10.120] => (item=/Users/vamshisiddarthgaddam/workspace/ansible_playground/roles/monit/tasks/../templates/monit/conf.d/filebeat.conf) ok: [172.16.10.120] => (item=/Users/vamshisiddarthgaddam/workspace/ansible_playground/roles/monit/tasks/../templates/monit/conf.d/filesystem.conf) TASK [ensure monit reloaded] ******************************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:59:43 +0400 (0:00:12.102) 0:02:00.790 ***** changed: [172.16.10.120] RUNNING HANDLER [reload monit] ***************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:44 +0400 (0:00:00.811) 0:02:01.602 ***** changed: [172.16.10.120] PLAY RECAP ************************************************************************************************************************************************************************************************************* 172.16.10.120 : ok=42 changed=11 unreachable=0 failed=0 skipped=10 rescued=0 ignored=0 Wednesday 27 January 2021 17:59:45 +0400 (0:00:01.330) 0:02:02.932 ***** =============================================================================== transfer monit-config configuration ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 12.10s common : set sysctl values ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 11.75s common : clone oh-my-zsh repo ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 7.82s common : clone oh-my-zsh repo ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 6.61s common : install pip packages ( aws .. ) ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 5.91s common : configure max open file number limits ------------------------------------------------------------------------------------------------------------------------------------------------------------------ 4.97s common : install system pakcages and utils ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- 4.60s common : disable kernel.mm.transparent_hugepage debian ---------------------------------------------------------------------------------------------------------------------------------------------------------- 3.34s common : deploy .extra ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.21s common : deploy .bash_profile ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.19s common : deploy .extra ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.19s transfer monit config /etc/monitrc ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.18s common : deploy .aliases ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.18s common : deploy .zshrc ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.17s common : deploy .zshrc ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.16s common : deploy .bash_profile ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.06s transfer monit config /etc/monit/monitrc ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.05s transfer monit id /var/lib/monit/id ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.02s common : deploy .aliases ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.01s common : transfer ssh config /etc/ssh/ssh_config ---------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.00s Warning Check the output and verify there are no errors that is interrupting the playbook from executing all the tasks. Fix all the errors when found.","title":"Base Role"},{"location":"base-role/#bastion-playbook","text":"Before executing the playbook, let's take a moment and understand what exactly is configured in the playbook. - name : dev bastion # Hostname configured as per Dynamic Inventory # You can understand more about this by executing ansible inventory command(ansible-inventory --list) hosts : tag_project_dev_bastion # User to run the playbook on the remote instance remote_user : ubuntu become : true # All the roles that we wish to execute on the remote instance # The roles declared here will be executed. Ansible will search for the roles under roles directory. # This is configured in ansible.cfg file roles : - { role : base , tags : [ 'base' ] } - { role : monit , tags : [ 'monit' ] }","title":"Bastion Playbook"},{"location":"base-role/#execution","text":"To execute the playbook, run the below command. Wait until the execution is completed and check for any errors. $ ansible-playbook dev-bastion.yml Output You should find the output similar to below. PLAY [dev bastion] ***************************************************************************************************************************************************************************************************** TASK [common : dpkg --configure -a] ************************************************************************************************************************************************************************************ Wednesday 27 January 2021 17:57:42 +0400 (0:00:00.070) 0:00:00.070 ***** changed: [172.16.10.120] TASK [common : install system pakcages and utils] ********************************************************************************************************************************************************************** Wednesday 27 January 2021 17:57:44 +0400 (0:00:02.013) 0:00:02.083 ***** ok: [172.16.10.120] TASK [common : correct python version selected] ************************************************************************************************************************************************************************ Wednesday 27 January 2021 17:57:49 +0400 (0:00:04.600) 0:00:06.683 ***** ok: [172.16.10.120] TASK [common : install pip packages ( aws .. )] ************************************************************************************************************************************************************************ Wednesday 27 January 2021 17:57:51 +0400 (0:00:02.412) 0:00:09.095 ***** ok: [172.16.10.120] TASK [common : enable /etc/default/sysstat] **************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:57:57 +0400 (0:00:05.913) 0:00:15.008 ***** ok: [172.16.10.120] TASK [common : set sysctl values] ************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:57:59 +0400 (0:00:01.478) 0:00:16.487 ***** ok: [172.16.10.120] => (item={'name': 'net.core.somaxconn', 'value': 65535}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.tcp_max_syn_backlog', 'value': 65535}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.tcp_fin_timeout', 'value': 20}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.tcp_max_tw_buckets', 'value': 1440000}) ok: [172.16.10.120] => (item={'name': 'vm.overcommit_memory', 'value': 1}) ok: [172.16.10.120] => (item={'name': 'vm.vfs_cache_pressure', 'value': 60}) ok: [172.16.10.120] => (item={'name': 'vm.max_map_count', 'value': 262144}) ok: [172.16.10.120] => (item={'name': 'fs.file-max', 'value': 1000000}) ok: [172.16.10.120] => (item={'name': 'kernel.pid_max', 'value': 65536}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.ip_local_port_range', 'value': '10000 65535'}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.udp_rmem_min', 'value': 8192}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.udp_wmem_min', 'value': 8192}) ok: [172.16.10.120] => (item={'name': 'net.ipv4.tcp_syncookies', 'value': 1}) ok: [172.16.10.120] => (item={'name': 'fs.nr_open', 'value': 10485760}) TASK [common : configure max open file number limits] ****************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:10 +0400 (0:00:11.748) 0:00:28.235 ***** ok: [172.16.10.120] => (item={'domain': '*', 'type': 'soft', 'name': 'memlock', 'value': 'unlimited'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'hard', 'name': 'memlock', 'value': 'unlimited'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'soft', 'name': 'nofile', 'value': '1000000'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'hard', 'name': 'nofile', 'value': '1000000'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'soft', 'name': 'nproc', 'value': '1000000'}) ok: [172.16.10.120] => (item={'domain': '*', 'type': 'hard', 'name': 'nproc', 'value': '1000000'}) TASK [common : disable kernel.mm.transparent_hugepage debian] ********************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:15 +0400 (0:00:04.965) 0:00:33.200 ***** ok: [172.16.10.120] TASK [common : disable kernel.mm.transparent_hugepage redhat] ********************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:19 +0400 (0:00:03.344) 0:00:36.544 ***** skipping: [172.16.10.120] TASK [common : Disable Transparent Huge Pages until reboot] ************************************************************************************************************************************************************ Wednesday 27 January 2021 17:58:19 +0400 (0:00:00.040) 0:00:36.585 ***** changed: [172.16.10.120] TASK [common : install git and zsh debian] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:20 +0400 (0:00:00.812) 0:00:37.398 ***** ok: [172.16.10.120] TASK [common : install git and zsh redhat] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:21 +0400 (0:00:01.704) 0:00:39.102 ***** skipping: [172.16.10.120] TASK [common : clone oh-my-zsh repo] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:21 +0400 (0:00:00.039) 0:00:39.142 ***** ok: [172.16.10.120] => (item={'name': 'https://github.com/robbyrussell/oh-my-zsh', 'dir': 'oh-my-zsh'}) ok: [172.16.10.120] => (item={'name': 'https://github.com/zsh-users/zsh-syntax-highlighting', 'dir': 'zsh-syntax-highlighting'}) ok: [172.16.10.120] => (item={'name': 'git://github.com/zsh-users/zsh-autosuggestions', 'dir': 'zsh-autosuggestions'}) TASK [common : create conf folder in home directory] ******************************************************************************************************************************************************************* Wednesday 27 January 2021 17:58:29 +0400 (0:00:07.820) 0:00:46.963 ***** ok: [172.16.10.120] => (item=/usr/local/share/oh-my-zsh/conf/) ok: [172.16.10.120] => (item=/usr/local/share/oh-my-zsh/cache/) TASK [common : deploy .zshrc] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:31 +0400 (0:00:01.830) 0:00:48.794 ***** ok: [172.16.10.120] TASK [common : deploy .extra] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:34 +0400 (0:00:03.172) 0:00:51.967 ***** ok: [172.16.10.120] TASK [common : deploy .aliases] **************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:37 +0400 (0:00:03.212) 0:00:55.180 ***** ok: [172.16.10.120] TASK [common : deploy .bash_profile] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:41 +0400 (0:00:03.178) 0:00:58.358 ***** ok: [172.16.10.120] TASK [common : remove standard zshrc] ********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:44 +0400 (0:00:03.064) 0:01:01.422 ***** changed: [172.16.10.120] TASK [common : symlink zshrc] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:44 +0400 (0:00:00.831) 0:01:02.254 ***** changed: [172.16.10.120] TASK [common : Update pamd rule's control in /etc/pam.d/chsh] ********************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:45 +0400 (0:00:00.824) 0:01:03.079 ***** ok: [172.16.10.120] TASK [common : set zsh as default shell] ******************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:58:46 +0400 (0:00:01.016) 0:01:04.095 ***** changed: [172.16.10.120] TASK [common : install git and zsh debian] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:47 +0400 (0:00:00.822) 0:01:04.917 ***** ok: [172.16.10.120] TASK [common : install git and zsh redhat] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:49 +0400 (0:00:01.667) 0:01:06.584 ***** skipping: [172.16.10.120] TASK [common : clone oh-my-zsh repo] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:49 +0400 (0:00:00.035) 0:01:06.620 ***** ok: [172.16.10.120] => (item={'name': 'https://github.com/robbyrussell/oh-my-zsh', 'dir': 'oh-my-zsh'}) ok: [172.16.10.120] => (item={'name': 'https://github.com/zsh-users/zsh-syntax-highlighting', 'dir': 'zsh-syntax-highlighting'}) ok: [172.16.10.120] => (item={'name': 'git://github.com/zsh-users/zsh-autosuggestions', 'dir': 'zsh-autosuggestions'}) TASK [common : create conf folder in home directory] ******************************************************************************************************************************************************************* Wednesday 27 January 2021 17:58:55 +0400 (0:00:06.607) 0:01:13.228 ***** ok: [172.16.10.120] => (item=/usr/local/share/oh-my-zsh/conf/) ok: [172.16.10.120] => (item=/usr/local/share/oh-my-zsh/cache/) TASK [common : deploy .zshrc] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:58:57 +0400 (0:00:01.600) 0:01:14.828 ***** ok: [172.16.10.120] TASK [common : deploy .extra] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:00 +0400 (0:00:03.162) 0:01:17.990 ***** ok: [172.16.10.120] TASK [common : deploy .aliases] **************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:03 +0400 (0:00:03.191) 0:01:21.181 ***** ok: [172.16.10.120] TASK [common : deploy .bash_profile] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:06 +0400 (0:00:03.006) 0:01:24.187 ***** ok: [172.16.10.120] TASK [common : remove standard zshrc] ********************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:10 +0400 (0:00:03.192) 0:01:27.380 ***** changed: [172.16.10.120] TASK [common : symlink zshrc] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:10 +0400 (0:00:00.824) 0:01:28.205 ***** changed: [172.16.10.120] TASK [common : Update pamd rule's control in /etc/pam.d/chsh] ********************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:11 +0400 (0:00:00.969) 0:01:29.175 ***** ok: [172.16.10.120] TASK [common : set zsh as default shell] ******************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:59:12 +0400 (0:00:00.806) 0:01:29.981 ***** changed: [172.16.10.120] TASK [common : transfer ssh config /etc/ssh/ssh_config] **************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:13 +0400 (0:00:00.811) 0:01:30.792 ***** ok: [172.16.10.120] TASK [ensure monit installed] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:16 +0400 (0:00:02.997) 0:01:33.790 ***** ok: [172.16.10.120] TASK [monit : Download EPEL Repo] ************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:18 +0400 (0:00:01.931) 0:01:35.721 ***** skipping: [172.16.10.120] TASK [ensure monit installed] ****************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:18 +0400 (0:00:00.040) 0:01:35.762 ***** skipping: [172.16.10.120] TASK [get monit version] *********************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:18 +0400 (0:00:00.041) 0:01:35.803 ***** changed: [172.16.10.120] TASK [set monit version] *********************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:19 +0400 (0:00:00.816) 0:01:36.620 ***** ok: [172.16.10.120] TASK [stop monit] ****************************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:19 +0400 (0:00:00.046) 0:01:36.667 ***** skipping: [172.16.10.120] TASK [monit dirs] ****************************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:19 +0400 (0:00:00.043) 0:01:36.711 ***** ok: [172.16.10.120] => (item=/var/monit/) ok: [172.16.10.120] => (item=//var/lib/monit/) ok: [172.16.10.120] => (item=/etc/monit/) TASK [/var/lib/monit/ dir] ********************************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:59:21 +0400 (0:00:02.555) 0:01:39.267 ***** skipping: [172.16.10.120] => (item=/etc/monit/conf.d/) skipping: [172.16.10.120] => (item=/var/lib/monit/) TASK [download and unzip monit] **************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:21 +0400 (0:00:00.048) 0:01:39.316 ***** skipping: [172.16.10.120] TASK [download and unzip monit] **************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:22 +0400 (0:00:00.034) 0:01:39.350 ***** skipping: [172.16.10.120] TASK [monit bin] ******************************************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:59:22 +0400 (0:00:00.041) 0:01:39.392 ***** skipping: [172.16.10.120] TASK [transfer monit config /etc/monit/monitrc] ************************************************************************************************************************************************************************ Wednesday 27 January 2021 17:59:22 +0400 (0:00:00.044) 0:01:39.436 ***** ok: [172.16.10.120] TASK [transfer monit config /etc/monitrc] ****************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:25 +0400 (0:00:03.049) 0:01:42.486 ***** ok: [172.16.10.120] TASK [transfer monit id /var/lib/monit/id] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:28 +0400 (0:00:03.181) 0:01:45.667 ***** ok: [172.16.10.120] TASK [transfer monit-config configuration] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:31 +0400 (0:00:03.020) 0:01:48.688 ***** ok: [172.16.10.120] => (item=/Users/vamshisiddarthgaddam/workspace/ansible_playground/roles/monit/tasks/../templates/monit/conf.d/sshd.conf) ok: [172.16.10.120] => (item=/Users/vamshisiddarthgaddam/workspace/ansible_playground/roles/monit/tasks/../templates/monit/conf.d/system.conf) ok: [172.16.10.120] => (item=/Users/vamshisiddarthgaddam/workspace/ansible_playground/roles/monit/tasks/../templates/monit/conf.d/filebeat.conf) ok: [172.16.10.120] => (item=/Users/vamshisiddarthgaddam/workspace/ansible_playground/roles/monit/tasks/../templates/monit/conf.d/filesystem.conf) TASK [ensure monit reloaded] ******************************************************************************************************************************************************************************************* Wednesday 27 January 2021 17:59:43 +0400 (0:00:12.102) 0:02:00.790 ***** changed: [172.16.10.120] RUNNING HANDLER [reload monit] ***************************************************************************************************************************************************************************************** Wednesday 27 January 2021 17:59:44 +0400 (0:00:00.811) 0:02:01.602 ***** changed: [172.16.10.120] PLAY RECAP ************************************************************************************************************************************************************************************************************* 172.16.10.120 : ok=42 changed=11 unreachable=0 failed=0 skipped=10 rescued=0 ignored=0 Wednesday 27 January 2021 17:59:45 +0400 (0:00:01.330) 0:02:02.932 ***** =============================================================================== transfer monit-config configuration ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 12.10s common : set sysctl values ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 11.75s common : clone oh-my-zsh repo ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 7.82s common : clone oh-my-zsh repo ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 6.61s common : install pip packages ( aws .. ) ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 5.91s common : configure max open file number limits ------------------------------------------------------------------------------------------------------------------------------------------------------------------ 4.97s common : install system pakcages and utils ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- 4.60s common : disable kernel.mm.transparent_hugepage debian ---------------------------------------------------------------------------------------------------------------------------------------------------------- 3.34s common : deploy .extra ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.21s common : deploy .bash_profile ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.19s common : deploy .extra ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.19s transfer monit config /etc/monitrc ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.18s common : deploy .aliases ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.18s common : deploy .zshrc ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.17s common : deploy .zshrc ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.16s common : deploy .bash_profile ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.06s transfer monit config /etc/monit/monitrc ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.05s transfer monit id /var/lib/monit/id ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.02s common : deploy .aliases ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.01s common : transfer ssh config /etc/ssh/ssh_config ---------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.00s Warning Check the output and verify there are no errors that is interrupting the playbook from executing all the tasks. Fix all the errors when found.","title":"Execution"},{"location":"demolition/","text":"Execute the below to destroy the newly created resources in aws once you are done using this to avoid unnecessary billing. $ ./run.sh destroy -auto-approve","title":"Destroy Resources"},{"location":"volume-mount/","text":"We will now mount the volume which is attached to the ec2 instance. The device name will differ depending on the type of the instance you choose. We have nvme1n1 and xvdh types configured here. Bastion Playbook \u00b6 Now, let's add the volume-mount role to the playbook which will look like below. - name : dev bastion hosts : tag_project_dev_bastion remote_user : ubuntu become : true roles : - { role : base , tags : [ 'base' ] } - { role : monit , tags : [ 'monit' ] } - { role : mount-drive , tags : [ 'mount-drive' ] } Execution \u00b6 To execute the playbook, run the below command. $ ansible-playbook dev-bastion.yml --tags = mount-drive Warning Check the output and verify there are no errors that is interrupting the playbook from executing all the tasks. Fix all the errors when found.","title":"Volume Mount"},{"location":"volume-mount/#bastion-playbook","text":"Now, let's add the volume-mount role to the playbook which will look like below. - name : dev bastion hosts : tag_project_dev_bastion remote_user : ubuntu become : true roles : - { role : base , tags : [ 'base' ] } - { role : monit , tags : [ 'monit' ] } - { role : mount-drive , tags : [ 'mount-drive' ] }","title":"Bastion Playbook"},{"location":"volume-mount/#execution","text":"To execute the playbook, run the below command. $ ansible-playbook dev-bastion.yml --tags = mount-drive Warning Check the output and verify there are no errors that is interrupting the playbook from executing all the tasks. Fix all the errors when found.","title":"Execution"},{"location":"Container/docker/","text":"Playbook \u00b6 We will now proceed with installation of Docker and Docker Compose on the remote instance using the roles. Add the docker and docker-compose roles to the playbook as shown below. - name : dev bastion hosts : tag_project_dev_bastion remote_user : ubuntu become : true roles : - { role : base , tags : [ 'base' ] } - { role : monit , tags : [ 'monit' ] } - { role : docker , tags : [ 'docker' ] } - { role : docker-compose , tags : [ 'docker-compose' ] } Execution \u00b6 To execute the playbook, run the below command. Wait until the execution is completed and check for any errors. Since we have already executed the base and monit roles, we can execute the docker and docker-compose roles explicitly using the tags as shown below. $ ansible-playbook dev-bastion.yml --tags = \"docker,docker-compose\" Output You should find the output similar to below. PLAY [dev bastion] ***************************************************************************************************************************************************************************************************** TASK [check whether docker exists] ************************************************************************************************************************************************************************************* Wednesday 27 January 2021 18:11:17 +0400 (0:00:00.124) 0:00:00.124 ***** ok: [172.16.10.120] TASK [copy docker official install script] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:18 +0400 (0:00:00.979) 0:00:01.103 ***** ok: [172.16.10.120] TASK [docker : run the script] ***************************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:21 +0400 (0:00:03.486) 0:00:04.589 ***** changed: [172.16.10.120] TASK [install docker] ************************************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:47 +0400 (0:00:26.237) 0:00:30.827 ***** ok: [172.16.10.120] TASK [configure docker daemon.json] ************************************************************************************************************************************************************************************ Wednesday 27 January 2021 18:11:49 +0400 (0:00:01.949) 0:00:32.777 ***** ok: [172.16.10.120] TASK [docker : service] ************************************************************************************************************************************************************************************************ Wednesday 27 January 2021 18:11:52 +0400 (0:00:03.010) 0:00:35.787 ***** skipping: [172.16.10.120] TASK [ensure \"docker\" group present] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:52 +0400 (0:00:00.037) 0:00:35.825 ***** ok: [172.16.10.120] TASK [add users into \"docker\"] ***************************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:54 +0400 (0:00:01.194) 0:00:37.019 ***** TASK [start docker] **************************************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:54 +0400 (0:00:00.036) 0:00:37.055 ***** ok: [172.16.10.120] TASK [docker-compose : Installing packages] **************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:55 +0400 (0:00:01.522) 0:00:38.578 ***** ok: [172.16.10.120] => (item=python-setuptools) TASK [docker-compose : remove python modules for docker] *************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:57 +0400 (0:00:01.674) 0:00:40.252 ***** ok: [172.16.10.120] TASK [docker-compose : install certain python modules for docker] ****************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:59 +0400 (0:00:01.639) 0:00:41.892 ***** changed: [172.16.10.120] => (item={'name': 'docker-compose', 'version': '1.27.4'}) changed: [172.16.10.120] => (item={'name': 'docker', 'version': '4.4.0'}) PLAY RECAP ************************************************************************************************************************************************************************************************************* 172.16.10.120 : ok=10 changed=2 unreachable=0 failed=0 skipped=2 rescued=0 ignored=0 Wednesday 27 January 2021 18:12:07 +0400 (0:00:08.356) 0:00:50.249 ***** =============================================================================== docker : run the script ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 26.24s docker-compose : install certain python modules for docker ------------------------------------------------------------------------------------------------------------------------------------------------------ 8.36s copy docker official install script ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.49s configure docker daemon.json ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.01s install docker -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.95s docker-compose : Installing packages ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.67s docker-compose : remove python modules for docker --------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.64s start docker ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.52s ensure \"docker\" group present ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.19s check whether docker exists ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.98s docker : service ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 0.04s add users into \"docker\" ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.04s","title":"Docker"},{"location":"Container/docker/#playbook","text":"We will now proceed with installation of Docker and Docker Compose on the remote instance using the roles. Add the docker and docker-compose roles to the playbook as shown below. - name : dev bastion hosts : tag_project_dev_bastion remote_user : ubuntu become : true roles : - { role : base , tags : [ 'base' ] } - { role : monit , tags : [ 'monit' ] } - { role : docker , tags : [ 'docker' ] } - { role : docker-compose , tags : [ 'docker-compose' ] }","title":"Playbook"},{"location":"Container/docker/#execution","text":"To execute the playbook, run the below command. Wait until the execution is completed and check for any errors. Since we have already executed the base and monit roles, we can execute the docker and docker-compose roles explicitly using the tags as shown below. $ ansible-playbook dev-bastion.yml --tags = \"docker,docker-compose\" Output You should find the output similar to below. PLAY [dev bastion] ***************************************************************************************************************************************************************************************************** TASK [check whether docker exists] ************************************************************************************************************************************************************************************* Wednesday 27 January 2021 18:11:17 +0400 (0:00:00.124) 0:00:00.124 ***** ok: [172.16.10.120] TASK [copy docker official install script] ***************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:18 +0400 (0:00:00.979) 0:00:01.103 ***** ok: [172.16.10.120] TASK [docker : run the script] ***************************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:21 +0400 (0:00:03.486) 0:00:04.589 ***** changed: [172.16.10.120] TASK [install docker] ************************************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:47 +0400 (0:00:26.237) 0:00:30.827 ***** ok: [172.16.10.120] TASK [configure docker daemon.json] ************************************************************************************************************************************************************************************ Wednesday 27 January 2021 18:11:49 +0400 (0:00:01.949) 0:00:32.777 ***** ok: [172.16.10.120] TASK [docker : service] ************************************************************************************************************************************************************************************************ Wednesday 27 January 2021 18:11:52 +0400 (0:00:03.010) 0:00:35.787 ***** skipping: [172.16.10.120] TASK [ensure \"docker\" group present] *********************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:52 +0400 (0:00:00.037) 0:00:35.825 ***** ok: [172.16.10.120] TASK [add users into \"docker\"] ***************************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:54 +0400 (0:00:01.194) 0:00:37.019 ***** TASK [start docker] **************************************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:54 +0400 (0:00:00.036) 0:00:37.055 ***** ok: [172.16.10.120] TASK [docker-compose : Installing packages] **************************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:55 +0400 (0:00:01.522) 0:00:38.578 ***** ok: [172.16.10.120] => (item=python-setuptools) TASK [docker-compose : remove python modules for docker] *************************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:57 +0400 (0:00:01.674) 0:00:40.252 ***** ok: [172.16.10.120] TASK [docker-compose : install certain python modules for docker] ****************************************************************************************************************************************************** Wednesday 27 January 2021 18:11:59 +0400 (0:00:01.639) 0:00:41.892 ***** changed: [172.16.10.120] => (item={'name': 'docker-compose', 'version': '1.27.4'}) changed: [172.16.10.120] => (item={'name': 'docker', 'version': '4.4.0'}) PLAY RECAP ************************************************************************************************************************************************************************************************************* 172.16.10.120 : ok=10 changed=2 unreachable=0 failed=0 skipped=2 rescued=0 ignored=0 Wednesday 27 January 2021 18:12:07 +0400 (0:00:08.356) 0:00:50.249 ***** =============================================================================== docker : run the script ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 26.24s docker-compose : install certain python modules for docker ------------------------------------------------------------------------------------------------------------------------------------------------------ 8.36s copy docker official install script ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.49s configure docker daemon.json ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 3.01s install docker -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.95s docker-compose : Installing packages ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.67s docker-compose : remove python modules for docker --------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.64s start docker ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.52s ensure \"docker\" group present ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.19s check whether docker exists ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.98s docker : service ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 0.04s add users into \"docker\" ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.04s","title":"Execution"},{"location":"ci/jenkins/","text":"Work In Progress \u00b6","title":"Jenkins"},{"location":"ci/jenkins/#work-in-progress","text":"","title":"Work In Progress"},{"location":"logging/elasticsearch/","text":"Work In Progress \u00b6","title":"ElasticSearch"},{"location":"logging/elasticsearch/#work-in-progress","text":"","title":"Work In Progress"},{"location":"logging/kibana/","text":"Work In Progress \u00b6","title":"Kibana"},{"location":"logging/kibana/#work-in-progress","text":"","title":"Work In Progress"},{"location":"logging/logstash/","text":"Work In Progress \u00b6","title":"Log Stash"},{"location":"logging/logstash/#work-in-progress","text":"","title":"Work In Progress"},{"location":"logging/beats/filebeat/","text":"Work In Progress \u00b6","title":"FileBeat"},{"location":"logging/beats/filebeat/#work-in-progress","text":"","title":"Work In Progress"},{"location":"logging/beats/journalbeat/","text":"Work In Progress \u00b6","title":"JournalBeat"},{"location":"logging/beats/journalbeat/#work-in-progress","text":"","title":"Work In Progress"},{"location":"logging/beats/metricbeat/","text":"Work In Progress \u00b6","title":"MetricBeat"},{"location":"logging/beats/metricbeat/#work-in-progress","text":"","title":"Work In Progress"},{"location":"monitoring/alertmanager/","text":"Work In Progress \u00b6","title":"Work In Progress"},{"location":"monitoring/alertmanager/#work-in-progress","text":"","title":"Work In Progress"},{"location":"monitoring/blackbox-exporter/","text":"Work In Progress \u00b6","title":"Balckbox Exporter"},{"location":"monitoring/blackbox-exporter/#work-in-progress","text":"","title":"Work In Progress"},{"location":"monitoring/grafana/","text":"Work In Progress \u00b6","title":"Grafana"},{"location":"monitoring/grafana/#work-in-progress","text":"","title":"Work In Progress"},{"location":"monitoring/prometheus/","text":"Work In Progress \u00b6","title":"Prometheus"},{"location":"monitoring/prometheus/#work-in-progress","text":"","title":"Work In Progress"}]}